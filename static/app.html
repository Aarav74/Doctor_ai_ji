<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical AI Assistant - Professional Healthcare System</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        :root {
            --primary: #3b82f6;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            font-family: 'Inter', system-ui, sans-serif;
            cursor: default;
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }
        
        /* Remove backdrop-filter from main containers to fix cursor issues */
        .glass-card-no-blur {
            background: rgba(30, 41, 59, 0.98);
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }
        
        .gradient-border {
            position: relative;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 2px solid transparent;
            background-clip: padding-box;
        }
        
        .gradient-border::before {
            content: '';
            position: absolute;
            inset: 0;
            padding: 2px;
            border-radius: inherit;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
        }
        
        .user-message {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            cursor: text;
        }
        
        .assistant-message {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: #e2e8f0;
            border: 1px solid rgba(148, 163, 184, 0.2);
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            cursor: text;
        }
        
        .prescription-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
            border-left: 4px solid #10b981;
        }
        
        .emergency-alert {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.1));
            border-left: 4px solid #ef4444;
            animation: pulse-border 2s infinite;
        }
        
        @keyframes pulse-border {
            0%, 100% { border-left-color: #ef4444; }
            50% { border-left-color: #fca5a5; }
        }
        
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #94a3b8;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            animation: typing-bounce 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing-bounce {
            0%, 80%, 100% { transform: translateY(0) scale(0.8); opacity: 0.5; }
            40% { transform: translateY(-10px) scale(1); opacity: 1; }
        }
        
        .quick-action-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer !important;
        }
        
        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .scroll-smooth {
            scroll-behavior: smooth;
            overflow-anchor: none;
        }
        
        /* Fix scrolling and pointer events */
        .chat-container {
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(59, 130, 246, 0.5) rgba(30, 41, 59, 0.3);
            pointer-events: auto !important;
        }
        
        .chat-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-container::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 3px;
        }
        
        .chat-container::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 3px;
        }
        
        .chat-container::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }
        
        .markdown-content h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #60a5fa;
        }
        
        .markdown-content strong {
            color: #fbbf24;
            font-weight: 600;
        }
        
        .markdown-content ul {
            margin-left: 1.5rem;
            margin-top: 0.5rem;
        }
        
        .markdown-content li {
            margin-bottom: 0.25rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.05));
            transition: all 0.3s;
            cursor: default;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(59, 130, 246, 0.2);
        }
        
        .image-upload-zone {
            border: 2px dashed rgba(148, 163, 184, 0.3);
            transition: all 0.3s;
            cursor: pointer !important;
        }
        
        .image-upload-zone:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }
        
        .pulse-icon {
            animation: pulse-scale 2s infinite;
        }
        
        @keyframes pulse-scale {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* FIXED: Text input styles for better visibility and cursor */
        .text-input {
            background: rgba(15, 23, 42, 0.9) !important;
            color: #f1f5f9 !important;
            border: 1px solid rgba(148, 163, 184, 0.3) !important;
            cursor: text !important;
            pointer-events: auto !important;
        }
        
        .text-input::placeholder {
            color: #94a3b8 !important;
        }
        
        .text-input:focus {
            border-color: #3b82f6 !important;
            background: rgba(15, 23, 42, 0.95) !important;
            color: #ffffff !important;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2) !important;
            outline: none;
        }

        /* FIXED: Select dropdown styles */
        .select-input {
            background: rgba(15, 23, 42, 0.9) !important;
            color: #f1f5f9 !important;
            border: 1px solid rgba(148, 163, 184, 0.3) !important;
            cursor: pointer !important;
            pointer-events: auto !important;
        }
        
        .select-input:focus {
            border-color: #3b82f6 !important;
            background: rgba(15, 23, 42, 0.95) !important;
            outline: none;
        }

        /* FIXED: Button styles */
        .interactive-btn {
            cursor: pointer !important;
            pointer-events: auto !important;
            position: relative;
            z-index: 10;
        }

        /* Ensure all interactive elements are clickable */
        input, select, button, textarea {
            pointer-events: auto !important;
            cursor: pointer !important;
        }

        input[type="text"], input[type="file"] {
            cursor: text !important;
        }

        select {
            cursor: pointer !important;
        }

        button {
            cursor: pointer !important;
        }

        /* Fix for backdrop-filter interference */
        .no-backdrop {
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
        }
    </style>
</head>
<body class="min-h-screen text-gray-100">
    <!-- Header -->
    <header class="glass-card-no-blur sticky top-0 z-50 border-b border-slate-700">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="text-4xl pulse-icon">üè•</div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                            Medical AI Assistant
                        </h1>
                        <p class="text-xs text-gray-400">Professional Healthcare Intelligence System v2.0</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <div class="hidden md:flex items-center gap-2 bg-green-500/20 px-3 py-1 rounded-full">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-xs text-green-400">AI Online</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8" style="pointer-events: auto;">
        <!-- Stats Overview -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="stat-card glass-card-no-blur rounded-xl p-4">
                <div class="flex items-center gap-3">
                    <div class="text-3xl">üí¨</div>
                    <div>
                        <div class="text-2xl font-bold text-blue-400" id="chatCount">0</div>
                        <div class="text-sm text-gray-400">Consultations</div>
                    </div>
                </div>
            </div>
            <div class="stat-card glass-card-no-blur rounded-xl p-4">
                <div class="flex items-center gap-3">
                    <div class="text-3xl">üî¨</div>
                    <div>
                        <div class="text-2xl font-bold text-purple-400" id="imageCount">0</div>
                        <div class="text-sm text-gray-400">Images Analyzed</div>
                    </div>
                </div>
            </div>
            <div class="stat-card glass-card-no-blur rounded-xl p-4">
                <div class="flex items-center gap-3">
                    <div class="text-3xl">üíä</div>
                    <div>
                        <div class="text-2xl font-bold text-green-400" id="prescriptionCount">0</div>
                        <div class="text-sm text-gray-400">Prescriptions</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6" style="pointer-events: auto;">
            <!-- Chat Section (2 columns) -->
            <div class="lg:col-span-2">
                <div class="glass-card-no-blur rounded-2xl p-6 gradient-border no-backdrop">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i data-lucide="bot" class="w-6 h-6 text-blue-400"></i>
                            AI Medical Consultant
                        </h2>
                        <button onclick="clearChat()" class="text-gray-400 hover:text-red-400 transition-colors interactive-btn">
                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                        </button>
                    </div>

                    <!-- Quick Actions -->
                    <div class="mb-4">
                        <p class="text-sm text-gray-400 mb-2">Quick symptoms:</p>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="quickMessage('I have a severe headache and fever')" 
                                    class="quick-action-btn interactive-btn bg-gradient-to-r from-blue-500/20 to-purple-500/20 hover:from-blue-500/30 hover:to-purple-500/30 border border-blue-500/30 text-blue-300 px-3 py-1.5 rounded-lg text-sm">
                                ü§ï Headache & Fever
                            </button>
                            <button onclick="quickMessage('I have chest pain and difficulty breathing')" 
                                    class="quick-action-btn interactive-btn bg-gradient-to-r from-red-500/20 to-orange-500/20 hover:from-red-500/30 hover:to-orange-500/30 border border-red-500/30 text-red-300 px-3 py-1.5 rounded-lg text-sm">
                                üö® Chest Pain
                            </button>
                            <button onclick="quickMessage('I have persistent cough and sore throat')" 
                                    class="quick-action-btn interactive-btn bg-gradient-to-r from-green-500/20 to-teal-500/20 hover:from-green-500/30 hover:to-teal-500/30 border border-green-500/30 text-green-300 px-3 py-1.5 rounded-lg text-sm">
                                ü§ß Cough & Throat
                            </button>
                            <button onclick="quickMessage('Tell me about COVID-19 symptoms and treatment')" 
                                    class="quick-action-btn interactive-btn bg-gradient-to-r from-purple-500/20 to-pink-500/20 hover:from-purple-500/30 hover:to-pink-500/30 border border-purple-500/30 text-purple-300 px-3 py-1.5 rounded-lg text-sm">
                                üò∑ COVID-19
                            </button>
                        </div>
                    </div>

                    <!-- Chat Messages -->
                    <div class="bg-slate-900/80 rounded-xl p-4 h-96 mb-4 chat-container scroll-smooth" id="chatContainer">
                        <div class="text-center text-gray-400 py-12" id="chatPlaceholder">
                            <div class="text-5xl mb-4">ü©∫</div>
                            <div class="text-lg font-semibold mb-2">Welcome to AI Medical Assistant</div>
                            <div class="text-sm">Describe your symptoms or ask health questions to get started</div>
                            <div class="mt-4 text-xs text-gray-500">Powered by advanced AI ‚Ä¢ Available 24/7</div>
                        </div>
                        <div id="chatMessages"></div>
                    </div>

                    <!-- Input Area - FIXED: Added proper text-input class -->
                    <div class="flex gap-2">
                        <input type="text" id="messageInput" 
                               placeholder="Describe your symptoms in detail..."
                               class="flex-1 text-input rounded-xl px-4 py-3 focus:outline-none transition-all interactive-btn">
                        <button onclick="sendMessage()" 
                                class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-xl font-medium transition-all transform hover:scale-105 flex items-center gap-2 shadow-lg interactive-btn">
                            <i data-lucide="send" class="w-5 h-5"></i>
                            Send
                        </button>
                    </div>
                </div>

                <!-- Medical Disclaimer -->
                <div class="mt-4 glass-card-no-blur rounded-xl p-4 border-l-4 border-amber-500">
                    <div class="flex items-start gap-3">
                        <i data-lucide="alert-triangle" class="w-5 h-5 text-amber-400 mt-0.5"></i>
                        <div class="text-sm text-amber-300">
                            <strong>Medical Disclaimer:</strong> This AI provides health information for educational purposes only. 
                            Not a substitute for professional medical advice. In emergencies, call 911 immediately.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Image Analysis Section (1 column) -->
            <div class="lg:col-span-1">
                <div class="glass-card-no-blur rounded-2xl p-6 gradient-border mb-6 no-backdrop">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i data-lucide="scan" class="w-5 h-5 text-purple-400"></i>
                        Medical Image Analysis
                    </h2>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Analysis Type:</label>
                            <!-- FIXED: Added select-input class -->
                            <select id="diseaseSelect" 
                                    class="w-full select-input rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-purple-500/20 interactive-btn">
                                <option value="skin_cancer">üî¨ Skin Cancer Detection</option>
                                <option value="pneumonia">ü´Å Pneumonia Detection (X-Ray)</option>
                            </select>
                        </div>

                        <div class="image-upload-zone rounded-xl p-6 text-center interactive-btn" onclick="document.getElementById('imageInput').click()">
                            <input type="file" id="imageInput" accept="image/*" class="hidden" onchange="previewImage(this)">
                            <div id="uploadPlaceholder">
                                <i data-lucide="upload-cloud" class="w-12 h-12 mx-auto text-gray-400 mb-2"></i>
                                <p class="text-sm text-gray-400">Click to upload medical image</p>
                                <p class="text-xs text-gray-500 mt-1">JPG, PNG up to 10MB</p>
                            </div>
                            <div id="imagePreview" class="hidden">
                                <img id="previewImg" class="max-h-48 mx-auto rounded-lg mb-2">
                                <p class="text-xs text-gray-400">Image ready for analysis</p>
                            </div>
                        </div>

                        <button onclick="analyzeImage()" 
                                class="w-full bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white py-3 rounded-xl font-medium transition-all transform hover:scale-105 flex items-center justify-center gap-2 shadow-lg interactive-btn">
                            <i data-lucide="microscope" class="w-5 h-5"></i>
                            Analyze with AI
                        </button>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="resultsSection" class="glass-card-no-blur rounded-2xl p-6 gradient-border hidden no-backdrop">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i data-lucide="file-text" class="w-5 h-5 text-blue-400"></i>
                        Analysis Results
                    </h3>
                    <div id="results" class="chat-container" style="max-height: 500px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        let chatCount = 0;
        let imageCount = 0;
        let prescriptionCount = 0;

        function updateStats() {
            document.getElementById('chatCount').textContent = chatCount;
            document.getElementById('imageCount').textContent = imageCount;
            document.getElementById('prescriptionCount').textContent = prescriptionCount;
        }

        function quickMessage(message) {
            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        function clearChat() {
            if (confirm('Clear all chat messages?')) {
                document.getElementById('chatMessages').innerHTML = '';
                document.getElementById('chatPlaceholder').style.display = 'block';
                chatCount = 0;
                prescriptionCount = 0;
                updateStats();
            }
        }

        function showTypingIndicator() {
            const messagesDiv = document.getElementById('chatMessages');
            const placeholder = document.getElementById('chatPlaceholder');
            
            if (placeholder) placeholder.style.display = 'none';

            const typingDiv = document.createElement('div');
            typingDiv.className = 'mb-4 text-left fade-in';
            typingDiv.id = 'typingIndicator';
            
            const bubble = document.createElement('div');
            bubble.className = 'inline-block max-w-md px-5 py-3 rounded-2xl assistant-message';
            bubble.innerHTML = `
                <div class="typing-indicator">
                    <span class="text-sm">AI is analyzing</span>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            
            typingDiv.appendChild(bubble);
            messagesDiv.appendChild(typingDiv);
            document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;

            addMessage('user', message);
            input.value = '';
            chatCount++;
            updateStats();

            showTypingIndicator();

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message, session_id: 'professional_session' })
                });

                const data = await response.json();
                hideTypingIndicator();
                
                if (data.has_prescription) {
                    prescriptionCount++;
                    updateStats();
                }
                
                addMessage('assistant', data.response);
            } catch (error) {
                hideTypingIndicator();
                addMessage('assistant', '‚ö†Ô∏è Sorry, there was an error. Please try again or contact support.');
            }
        }

        function addMessage(role, content) {
            const messagesDiv = document.getElementById('chatMessages');
            const placeholder = document.getElementById('chatPlaceholder');
            
            if (placeholder) placeholder.style.display = 'none';

            const messageDiv = document.createElement('div');
            messageDiv.className = `mb-4 ${role === 'user' ? 'text-right' : 'text-left'} fade-in`;
            
            const bubble = document.createElement('div');
            bubble.className = `inline-block max-w-md px-5 py-3 rounded-2xl ${
                role === 'user' 
                    ? 'user-message' 
                    : 'assistant-message'
            }`;
            
            // Enhanced markdown formatting
            let formatted = content
                .replace(/### (.*?)(\n|$)/g, '<h3 class="text-lg font-bold text-blue-400 mb-2">$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong class="text-yellow-300 font-semibold">$1</strong>')
                .replace(/üíä \*\*Recommended Medications:\*\*/g, '<div class="prescription-card p-3 rounded-lg mt-2 mb-2"><strong class="text-green-400">üíä Recommended Medications:</strong>')
                .replace(/üè• \*\*Care Instructions:\*\*/g, '</div><div class="bg-blue-500/10 p-3 rounded-lg mt-2 mb-2"><strong class="text-blue-400">üè• Care Instructions:</strong>')
                .replace(/‚öïÔ∏è \*\*See a Doctor If:\*\*/g, '</div><div class="bg-amber-500/10 p-3 rounded-lg mt-2 mb-2"><strong class="text-amber-400">‚öïÔ∏è See a Doctor If:</strong>')
                .replace(/‚ö†Ô∏è \*\*EMERGENCY ALERT\*\*/g, '<div class="emergency-alert p-4 rounded-lg my-2"><strong class="text-red-400 text-lg">üö® EMERGENCY ALERT</strong>')
                .replace(/üö® \*\*Call emergency services/g, '<div class="text-red-300 font-bold mt-2">üö® Call emergency services')
                .replace(/  ‚Ä¢ /g, '<br>  ‚Ä¢ ')
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>');
            
            // Close any open divs
            const openDivs = (formatted.match(/<div/g) || []).length;
            const closeDivs = (formatted.match(/<\/div>/g) || []).length;
            for (let i = 0; i < openDivs - closeDivs; i++) {
                formatted += '</div>';
            }
            
            bubble.innerHTML = `<div class="markdown-content">${formatted}</div>`;
            messageDiv.appendChild(bubble);
            messagesDiv.appendChild(messageDiv);
            
            const container = document.getElementById('chatContainer');
            container.scrollTop = container.scrollHeight;
        }

        function previewImage(input) {
            const placeholder = document.getElementById('uploadPlaceholder');
            const preview = document.getElementById('imagePreview');
            const img = document.getElementById('previewImg');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    img.src = e.target.result;
                    placeholder.classList.add('hidden');
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function analyzeImage() {
            const fileInput = document.getElementById('imageInput');
            const diseaseSelect = document.getElementById('diseaseSelect');
            const resultsSection = document.getElementById('resultsSection');
            const resultsDiv = document.getElementById('results');

            if (!fileInput.files.length) {
                alert('‚ö†Ô∏è Please select an image first');
                return;
            }

            resultsSection.classList.remove('hidden');
            resultsDiv.innerHTML = `
                <div class="text-center py-8">
                    <div class="typing-indicator inline-flex">
                        <span>AI analyzing image</span>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('disease', diseaseSelect.value);

            try {
                const response = await fetch('/api/diagnose', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                imageCount++;
                updateStats();

                const isEmergency = data.predicted_label.toLowerCase().includes('malignant') || 
                                   data.predicted_label.toLowerCase().includes('pneumonia');
                
                resultsDiv.innerHTML = `
                    <div class="space-y-4 fade-in">
                        <div class="p-4 rounded-xl ${isEmergency ? 'bg-red-500/20 border-2 border-red-500' : 'bg-green-500/20 border-2 border-green-500'}">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-bold text-lg ${isEmergency ? 'text-red-400' : 'text-green-400'}">${data.predicted_label}</h4>
                                <span class="text-2xl">${isEmergency ? '‚ö†Ô∏è' : '‚úì'}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="flex-1 bg-slate-700 rounded-full h-2">
                                    <div class="h-2 rounded-full ${isEmergency ? 'bg-red-500' : 'bg-green-500'}" 
                                         style="width: ${data.confidence}%"></div>
                                </div>
                                <span class="text-sm font-semibold">${data.confidence}%</span>
                            </div>
                        </div>
                        
                        <div class="bg-slate-700/30 p-4 rounded-xl">
                            <h5 class="font-semibold text-blue-400 mb-2">üìã Description</h5>
                            <p class="text-sm text-gray-300">${data.description}</p>
                        </div>
                        
                        ${data.symptoms.length ? `
                        <div class="bg-slate-700/30 p-4 rounded-xl">
                            <h5 class="font-semibold text-purple-400 mb-2">üîç Symptoms</h5>
                            <ul class="text-sm text-gray-300 space-y-1">
                                ${data.symptoms.map(s => `<li>‚Ä¢ ${s}</li>`).join('')}
                            </ul>
                        </div>
                        ` : ''}
                        
                        <div class="bg-blue-500/10 border border-blue-500/30 p-4 rounded-xl">
                            <h5 class="font-semibold text-blue-400 mb-2">üí° Treatment Overview</h5>
                            <p class="text-sm text-gray-300">${data.treatment_overview}</p>
                        </div>
                        
                        ${data.heatmap_image ? `
                        <div class="bg-slate-700/30 p-4 rounded-xl">
                            <h5 class="font-semibold text-green-400 mb-3">üéØ AI Focus Areas</h5>
                            <img src="data:image/png;base64,${data.heatmap_image}" 
                                 class="w-full rounded-lg border border-slate-600 shadow-xl">
                        </div>
                        ` : ''}
                        
                        ${isEmergency ? `
                        <div class="emergency-alert p-4 rounded-xl">
                            <p class="text-red-300 font-semibold">
                                ‚ö†Ô∏è This condition requires immediate medical attention. 
                                Please consult a healthcare professional as soon as possible.
                            </p>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                lucide.createIcons();
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="text-center py-8 text-red-400">
                        <i data-lucide="alert-circle" class="w-12 h-12 mx-auto mb-3"></i>
                        <p class="font-semibold">Analysis Error</p>
                        <p class="text-sm text-gray-400 mt-2">Please try again or contact support</p>
                    </div>
                `;
                lucide.createIcons();
            }
        }

        // Enter key to send
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // Auto-focus
        document.getElementById('messageInput').focus();

        // Initialize
        updateStats();
        
        // Add welcome message
        setTimeout(() => {
            addMessage('assistant', `### üëã Welcome to Medical AI Assistant!

I'm here to help you with:

üíä **Symptom Analysis** - Describe your symptoms and get detailed medical guidance
üî¨ **Image Diagnosis** - Upload medical images for AI-powered analysis  
üìã **Treatment Recommendations** - Receive prescription suggestions and care instructions
‚öïÔ∏è **Medical Guidance** - Get advice on when to seek professional help

**How to use:**
1. Simply describe your symptoms in the chat
2. Use quick action buttons for common conditions
3. Upload medical images for detailed analysis

‚ö†Ô∏è **Remember:** This is an AI assistant for information only. Always consult healthcare professionals for medical decisions.

What health concerns can I help you with today?`);
        }, 500);
    </script>
</body>
</html>